After burying Dobby, Harry Potter asks the goblin Griphook to help him, along with Ron Weasley and Hermione Granger, break into Bellatrix Lestrange's vault at Gringotts bank, suspecting a Horcrux may be there. Griphook agrees, in exchange for the Sword of Gryffindor. Wandmaker Ollivander tells Harry that two wands taken from Malfoy Manor belonged to Bellatrix and Draco Malfoy, though Draco's has changed its allegiance to Harry.

In the vault, they discover another Horcrux: Helga Hufflepuff's cup. Harry retrieves it, but Griphook snatches the sword and abandons them. Trapped by security, they release the dragon guardian and flee on its back. Harry has a vision of Lord Voldemort at Gringotts, furious at the theft. Harry also realises that there is a Horcrux at Hogwarts which is somehow connected to Rowena Ravenclaw. The trio apparate into Hogsmeade, where Aberforth Dumbledore reveals a secret passageway into Hogwarts.

Severus Snape hears of Harry's return and warns staff and students of punishment for aiding Harry. Harry confronts Snape, who flees after Minerva McGonagall challenges him to a duel. McGonagall gathers the Hogwarts community for battle. At Luna Lovegood's insistence, Harry speaks to Helena Ravenclaw's ghost, who reveals that Voldemort performed "dark magic" on her mother's diadem, located in the Room of Requirement. In the Chamber of Secrets, Hermione destroys the Horcrux cup with a Basilisk fang. In the Room of Requirement, Draco, Blaise Zabini and Gregory Goyle attack Harry, but Ron and Hermione intervene. Goyle casts a Fiendfyre curse; unable to control it, he is burned to death while Harry and his friends save Malfoy and Zabini. Harry stabs the diadem with the Basilisk fang, and Ron kicks it into the inferno to be destroyed. As Voldemort's army attacks, Harry, seeing into Voldemort's mind, realises that Voldemort's snake Nagini is the final Horcrux. After entering the boathouse, the trio witness Voldemort telling Snape that the Elder Wand cannot serve Voldemort until Snape dies; he then orders Nagini to kill Snape. Dying, Snape weeps and tells Harry to take his tears to the Pensieve. Meanwhile, Fred Weasley, Remus Lupin, and Nymphadora Tonks are killed in the chaos at Hogwarts.

The Pensieve shows Snape's memories to Harry: Snape despised Harry's late father James, who bullied him, but he loved his late mother Lily. Following her death, Snape worked with Albus Dumbledore to protect Harry from Voldemort due to his love for Lily. Harry also learns that Dumbledore was dying and wished for Snape to kill him, and that the Patronus doe he saw in the woods that led him to the sword was conjured by Snape. Harry learns that he himself became a Horcrux when Voldemort originally failed to kill him; he must die to destroy the piece of Voldemort's soul within himself. Harry uses the Resurrection Stone to summon his deceased loved ones, to comfort him and strengthen his courage, before he surrenders himself to Voldemort in the Forbidden Forest. Voldemort casts the Killing Curse upon Harry, who finds himself in limbo. Dumbledore's spirit meets him and explains that Harry is free of Voldemort, and can choose to move on.

Voldemort announces Harry's apparent death to everyone at Hogwarts and demands their surrender. As Neville Longbottom gives a defiant response and draws the sword from the Sorting Hat, Harry reveals he is still alive; the Malfoys and many Death Eaters abandon Voldemort. While Harry confronts Voldemort in a duel throughout the castle, Molly Weasley kills Bellatrix in the Great Hall and Neville decapitates Nagini, making Voldemort mortal. Harry and Voldemort's fight ends with Voldemort's own Killing Curse rebounding and obliterating him. After the battle, Harry explains to Ron and Hermione that the Elder Wand recognised him as its true master after he disarmed Draco, who had earlier disarmed its previous owner, Dumbledore. Instead of claiming the Elder Wand, Harry destroys it.

Nineteen years later, Harry and Ginny, Ron and Hermione, and Draco proudly watch their children leave for Hogwarts at King's Cross station.